generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

//////////////////////
// ENUMS
//////////////////////

enum TipoUsuario {
  ADMIN
  COMUM
}

enum AuthProvider {
  LOCAL
  GOOGLE
}

enum StatusCompra {
  pending
  approved
  in_process
  rejected
  cancelled
  refunded
  charged_back
  expired
}

//////////////////////
// MODELS
//////////////////////

model Usuario {
  id               String        @id @default(auto()) @map("_id") @db.ObjectId

  // DADOS BÁSICOS
  nome             String
  email            String        @unique

  // AUTENTICAÇÃO
  senha            String?
  provider         AuthProvider  @default(LOCAL)
  providerId       String?
  emailVerificado  Boolean       @default(false)
  tokenVerificacao String?

  // PERFIL
  avatar           String?
  dataNascimento   DateTime?
  telefone         String?

  // PROGRESSO DO PERFIL (1 a 3)
  perfilEtapa      Int           @default(1)

  // VOUCHER
  voucherAtivo     Boolean       @default(false)
  voucherUsos      Int           @default(0)
  voucherMaxUsos   Int           @default(3)

  // CONTROLE
  tipo             TipoUsuario   @default(COMUM)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  // RELAÇÕES
  credenciais      Credencial[]
  notificacoes     Notificacao[]
  compras          Compra[]
}

model Credencial {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId

  orderID   String   @unique
  user      String
  pass      String
  platform  String
  ba        String
  limit     Int?
  sortMode  String?
  persona   String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  usuarioId String   @db.ObjectId
  usuario   Usuario  @relation(fields: [usuarioId], references: [id])
}

model Banner {
  id       String   @id @default(auto()) @map("_id") @db.ObjectId
  caminho  String
  url      String?
  criadoEm DateTime @default(now())
}

model MoedaPreco {
  id   String @id @default(auto()) @map("_id") @db.ObjectId
  play Int
  xbox Int
  pc   Int
}

model Cupom {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  parceiro  String
  codigo    String   @unique
  desconto  Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Notificacao {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  usuarioId String   @db.ObjectId
  usuario   Usuario  @relation(fields: [usuarioId], references: [id])

  mensagem  String
  vista     Boolean  @default(false)
  criadoEm  DateTime @default(now())
}

model Compra {
  id          String       @id @default(auto()) @map("_id") @db.ObjectId

  usuarioId   String       @db.ObjectId
  usuario     Usuario      @relation(fields: [usuarioId], references: [id])

  plataforma  String
  quantia     Float
  moeda       String

  status      StatusCompra @default(pending)

  // MERCADO PAGO
  mpPreferenceId String?
  mpPaymentId    String?
  mpStatus       String?

  pagoEm        DateTime?
  expiradoEm    DateTime?
  concluidoEm   DateTime?

  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
}
